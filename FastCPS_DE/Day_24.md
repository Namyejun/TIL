## Ch 11. Data Modeling

### 1. 데이터 모델링의 기초

- **데이터 모델링이 필요한 이유**
    
    우리가 사용하는 온라인 서비스를 생각해보자. **모든 내용은 데이터를 표현**한다. **데이터는 어딘가에는 담겨 있다**. 수 많은 종류의 서비스나 기능이 나왔다가 사라진다. 데이터가 추가되고 삭제된다. 유저의 활동은 모두 데이터이다. 유저의 눈에 보이지 않아도 수집되는 수 많은 데이터가 있다. 기업은 그 데이터로 더 나은 서비스를 제공하고 더 많은 돈을 벌기 위해 노력한다.
    **가능한 모든 데이터를 쌓아놓고 활용하면 될까?** 데이터가 있다는 것은 **어떤 컴퓨터는 그 데이터를 메모리나 디스크에 보관**하고있다는 의미이다. **데이터를 보관하는 데는 비용**이 든다. 데이터를 조회하는 데도 비용이 든다. 더 좋은 서비스를 제공하기 위해서, 더 많은 돈을 벌기 위해서는 **데이터를 잘 사용**해야한다.
    데이터를 잘 사용하기 위해서는 데이터 모델링이 필요하다.
    
    똑같이 100GB의 데이터를 저장하고 있지만, 어떤 시스템은 유저 1천명의 데이터를 저장하고, 어떤 시스템은 유저 1만명의 데이터를 저장할 수 있다. 이 비용 차이는 얼마나 될까? 만약에 유저가 1억명이라면 어떻게 될까?
    똑같이 100GB의 데이터를 저장하고 있지만, 어떤 시스템은 원하는 데이터를 조회하는데 1초가 걸리는데, 어떤 시스템은 1ms가 걸린다. 이 차이는 어떤 영향을 미칠까? 그 **부가가치는 얼마나 될까?**
    데이터 모델링은 이 모든 문제를 최적으로 해결할 수 있는 마법 공식인가? 아니다. **데이터 모델링에는 논리적인 이론, 개념 설계가 필요**하다. 또한 **데이터 모델링에는 각 데이터를 다루는 도구에 대한 구체적인 지식**이 필요하다. 마지막으로 **데이터 모델링에는 자신이 사용할 시스템과 데이터의 크기에 따른 대한 정밀한 계산**이 필요하다.
    
    **우선 구축하고, 공부하면서 천천히 옮겨가면 되지 않을까? → 결론은 아니라는 것**
    100GB의 데이터로 1천명을 저장하던 시스템을 운영하다가, 1만명의 데이터를 저장할 수 있는 시스템을 만드는 방법을 찾았다.
    그러면 바로 새로운 시스템을 구축할 수 있을까? 그렇다면 200GB가 필요하다. 단순히 서버를 구매하면 될까? 만약 이 대상이 200PB라면 어떨까? 이 정도 규모의 서비스를 쉽게 구매하고 다시 되팔 수 있을까? 이 **마이그레이션의 손실**은 얼마나 날까?
    
- **모델링 방식**
    - **Top-Down**
        
        **추상적인 요구사항으로부터 구체적인 구현 방식까지 좁혀들어오면서 사고**하는 방식이다. Top-Down 방식의 **장점은 도구를 한정하지 않고 논리적인 과정을 거치기** 때문에 **서비스/비즈니스/기술의 수준이 높아질 수 있는 가능성**이 있다는 것이다. 다만, 이것은 **추상적인 모델링을 하는 이들이 논리적으로 타당함**을 갖출 뿐만 아니라 **모델링 능력과 경험이 있어야 가능**하다. Top-Down이기는 하나 **이론적인 배경이 없거나, 구현체를 하나도 모른다면 Top-Down 이 불가능**하다.
        
    - **Bottom-Up**
        
        **쓸 수 있는 도구가 한정되어있을 때 사용하는 방식**이다. 이유는 다양할 수 있다. **개발자의 역량, 비용, 인프라, 그리고 개발문화 등** 여러 이유 때문에 써야하는 도구가 정해질 수 있다.
        이런 경우에는 **해당 도구로 지원가능한 기능, 기술을 기반으로 요구사항에서 불가능한 것들을 제외하거나, 요구사항을 변경**해야 하는 경우가 생긴다.
        DB는 꽤나 복잡하고, 성숙도에 따라서 잘 알려지지 않은 기능들도 방대하다. **Bottom-Up 방식을 쓴다면 하나에 대해서 깊이 이해하며 구현할 수 있다는 점이 개발자로 성장**할 수 있는 포인트이다.
        하지만, 악마는 디테일에 있다는 말처럼 **디테일에 파묻혀서 큰 그림이 이상해질 위험**도 있다. **개발자의 역량 때문에 도구가 제한된다면 가장 안좋은 케이스**이므로 **서버/데이터 엔지니어라면 데이터베이스에 대한 공부**를 꾸준히 하는 것이 좋다.
        
    - **현실적인 방법**
        
        Top-Down 이 정답도, Bottom-Up 도 정답이 아니다.
        현실적으로 내가 **어떤 DB 종류를 쓸 줄 아느냐를 넘어서**, 그 **DB의 동작 방식 또는 구현체에 대해서 얼마나 알고있느냐가 영향**을 미친다.
        **Top-Down으로 의사결정한 내용이, Bottom-Up 으로 결정된 요구사항에 의해 제약**이 생길 수 있기 때문이다.
        다음과 같은 사례를 들 수 있다.
        
        <aside>
        ℹ️ SNS 서비스를 만드는데 추상적인 모델링으로는 **HBase를 사용하는 것이 용량과 속도의 요건을 맞추기 때문에 옳지만**, 실제 구현해야할 내용에 **transactional 처리(e.g. mutli row lock)가 이 필요**하다면 lock을 **HBase는 lock을 걸 수 없기 때문에 선택할 수 없다.**
        
        </aside>
        
        - Q: 이 사례에서 개발자가 HBase의 추상적인 내용은 알지만 lock을 걸 수 없다는 사실을 모르고, HBase를 구축하고 개발까지 진행했다면 어떻게 될까? → 마이그레이션을 해야함
        
        ---
        
        **Top-Down**
        
        1. 서비스/비즈니스 요구사항을 한다.
        2. 서비스/비즈니스 요구사항으로부터 시스템/소프트웨어 요구사항을 도출한다.
        3. 시스템 요구사항을 기반으로 Top-Down 방식으로 추상적인 모델링을 한다.
        
        **Bottom-Up**
        
        1. 내가 선택할 수 있는 DB의 종류를 열거한다.
        a. 내가 아는 것
        b. 물리적/비용적으로 지원 가능한 것
        2. 해당 DB 종류들의 특징(장점, 단점, 제약사항)을 파악한다.
        3. DB 선택지별로 trade-off를 고려한다.(matix로 표현하는 것이 좋다.)
        
        **Mixed**
        
        - 위의 Top-Down, Bottom-Up을 고려했을 때 가능한 선택지를 뽑는다.
        - 가능한 선택지 중에 trade-off와 개발/운영자의 의사를 반영해서 결정한다.
        
        ---