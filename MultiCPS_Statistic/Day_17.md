## **모평균 비교에 관한 가설검정(Two way ANOVA)**

### 요인설계(Factorial Design)

- 반응 변수에 영향을 미치는 요인의 수가 여러 개인 경우, 요인설계(factorial design)을 적용해야함

### 이원배치 분산분석(Two way ANOVA)

- 가장 단순한 요인 설계 분석법으로 요인이 2개, 각 요인별 처리수준이 2개 이상인 경우
    - 주 효과 : 각 요인 별 처리수준 간의 모평균 차이에 관한 분석
    - 상호작용 효과 : 두 요인 간 상호작용에 관한 분석
    - 예시 : 아이스크림을 출시해 광고 컨셉을 정하는 문제가 있다. 컨셉으로 맛을 강조하는게 있고 가격을 강조하는 컨셉이 있고 이벤트를 강조하는 컨셉이 있다. 이 세가지에 따라서 아이스크림 매출의 평균적인 차이가 있을까? 현재까지는 광고 컨셉이라는 한가지 요인에 세가지 처리가 구분 됨 → one way anova
    그런데 광고 방법에 이메일이나 전단지라는 두 개의 선택지를 넣어주면 광고의 방법이라는 다른 요인에 의해서 2개의 treatment로 구분될 수 있다는 것이다. 이 요인 두 가지를 동시에 고려시→ two way anova
        - 첫번째 주효과는 광고 컨셉으로 인한 평균 매출의 차이이고 두번째 주효과는 광고 방법으로 인한 평균 매출의 차이이다. 상호작용 효과는 어떤 방법과 어떤 컨셉이 만나면 시너지나 효과가 추가로 생겨나는 것.
- 완전 확률화 과정 : 실험 대상은 각 요인의 처리 수준별 조합(셀)에 무작위로 배치됨.
- 가정 : 정규, 등분산, 독립

- 이원배치 분산분석 자료구조
(각 셀 별 반복수 n이 동일한 경우)
    
    ![Untitled](img/Untitled%2014.png)
    
    - a * b 개의 셀이 만들어지고 각각의 셀마다 반복수를 n으로 둬서 셀마다 n만큼의 자료가 관찰됨
    - 각 행별, 열별 평균 또한 전체 평균이 필요하다.

### 제곱합의 분해

SST = SSA + SSB + SSAB + SSE

총 변동성 = 요인 A 처리변동 + 요인 B 처리변동 + 요인 A, B의 상호작용변동 + 오차변동

(abn - 1) = (a - 1) + (b - 1) + (a - 1)*(b - 1) + ab(n - 1)

- SSA, SSB는 해당 factor로 구분한 treatment 평균의 변동, 각 요인의 평가요소
- SSAB는 셀별 평균이 $\bar y_{ij}$일 때 셀별 평균의 변동, 상호작용 효과의 평가 요소
- SSE는 그룹안에 있는 n개의 자료가 자신의 평균으로부터 얼마나 변동하는가. 그룹 내에서의 변동
- 실제로 검정할 때는 자신의 자유도로 나눠서 **MS(mean square) 통계량으로 바꿔 검정**을 해줌
- factor A에 효과가 있다면 MSE보다 MSA가 커짐, 효과가 없으면 둘이 비슷해짐 → $\dfrac {MSA} {MSE}$
- factor B에 대해서도 마찬가지 → $\dfrac {MSB} {MSE}$
- 상호작용효과도 마찬가지 → $\dfrac {MSAB} {MSE}$

### 이원배치 분산분석의 가설검정 절차

- 가설
    1. 요인 A의 처리효과에 관한 가설
        - $H_0$ : 요인 A의 처리 그룹 간 평균의 차이가 없음. 처리효과 없음
        - $H_1$ : 요인 A의 처리 그룹 간 평균의 차이가 존재. 처리효과 있음
    2. 요인 B의 처리효과에 관한 가설
        - $H_0$ : 요인 B의 처리 그룹 간 평균의 차이가 없음. 처리효과 없음
        - $H_1$ : 요인 B의 처리 그룹 간 평균의 차이가 존재. 처리효과 있음
    3. 요인 A와 요인 B의 상호작용 효과에 관한 가설
        - $H_0$ : 요인 A와 요인 B의 상호작용 효과 없음.
        - $H_1$ : 요인 A와 요인 B의 상호작용 효과 존재.
- 검정 통계량의 표본분포
    1. 요인 A의 처리효과
        - 요인 A에 관한 $H_0$이 사실인 경우, 
        $F_1 = \dfrac {MSA} {MSE} = \dfrac {SSA/(a-1)} {SSE/(ab(n-1))} \sim F[a-1,ab(n-1)]$
    2. 요인 B의 처리효과
        - 요인 B에 관한 $H_0$이 사실인 경우,
        $F_2 = \dfrac {MSB} {MSE} = \dfrac {SSB/(b-1)} {SSE/(ab(n-1))} \sim F[b-1,ab(n-1)]$
    3. 요인 A와 요인 B의 상호작용 효과
        - 요인 A와 요인 B의 상호작용에 관한 $H_0$이 사실인 경우,
        $F_3 = \dfrac {MSAB} {MSE} = \dfrac {SSAB/(a-1)(b-1)} {SSE/(ab(n-1))} \sim F[(a-1)(b-1),ab(n-1)]$

- 유의확률(p-value)의 계산
    - 귀무가설 $H_0$가 사실일 때 검정통계량의 분포에서,
        
        $f_0$(= 표본 자료로부터 계산된 검정 통계량의 값) 보다 더 큰 값이 나올 확률
        
        - 오른 꼬리 검정인 이유는 귀무가설을 기각하려면 MSA가 커져야하기 때문이다.
- 유의수준(significance level) $100 \alpha \%$의 검정법
    - 자료로부터 계산된 유의 확률(p-value)이 주어진 유의수준 $\alpha$보다 작은 경우에 귀무가설 $H_0$를 기각함.
    - $p-value ≤ \alpha$면 $H_0$를 기각.

![Untitled](img/Untitled%2015.png)
